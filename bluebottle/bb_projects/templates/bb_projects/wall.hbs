{% load bb_ember %}
{% load i18n %}
{% load static %}

{% tplhandlebars "project_wall" %}

    <div class="l-section" id="wallposts">
        <section class="l-wrapper">

            <div class="wallposts-list">
                <div class="wallpost-title">
                    <h3>{% trans "Project Wall" %}</h3>
                    <small class="latest-update">
                        {% trans 'Latest update'%}: 
                        {{#if firstObject.created}}
                            {{ localize firstObject.created formatting="X"}}
                        {{else}}
                            {% trans 'no post yet, be the first:)'%}
                        {{/if}}
                    </small>
                </div>
                {{#if currentUser.isAuthenticated }}
                    {{#if canAddMediaWallPost}}
                        {{ render "mediaWallPostNew" parentId=parentId}}
                    {{else}}
                        {{ render "textWallPostNew" }}
                    {{/if}}
                {{/if}}

                {{#each item in controller itemController="wallPost"}}
                    {{#if item.isLoaded}}
                        {{#if item.isSystemWallPost}}
                            {{view "App.SystemWallPostView"}}
                        {{else}}
                            {{view "App.MediaWallPostView"}}
                        {{/if}}
                    {{/if}}
                {{/each}}

                {{#if canLoadMore}}
                    <a {{action "showMore"}} class="btn-link btn-more">
                        <span class="flaticon solid plus-2"></span> {% trans "Show more" %} <small>{{remainingItemCount}} {% trans "more" %}</small>
                    </a>
                {{/if}}

            </div>


            <div class="wallposts-important" id="activity">
                {{#if controllers.project.amount_asked}}
                    <section id="fundraiser-list">
                        {{render 'projectFundRaiserList'}}
                    </section>
                {{/if}}

                <section id="task-list" {{bind-attr class="canDonate:normal:offset"}}>
                    {{#if isProjectOwner}}
                        <div class="task-action">
                            {{#link-to 'taskNew' controllers.project.id class="btn btn-modest"}}
                                <span class="flaticon stroke work-1"></span>
                                {% trans 'Create task' %}
                            {{/link-to}}
                        </div>
                    {{/if}}
                    
                    {{#if availableTasks}}
                        <div class="task-list-wrapper task-list-open">
                            <h3>{% trans "Open tasks" %}</h3>
                            {{#each availableTasks}}
                                {{view App.TaskSummaryView contentBinding='this'}}
                            {{/each}}
                        </div>
                    {{/if}}
                
                    {{#if unavailableTasks}}
                        <div class="task-list-wrapper task-list-closed">
                            <h3>{% trans "In progress & closed tasks" %}</h3>
                            {{#each unavailableTasks}}
                                {{view App.TaskSummaryView contentBinding='this'}}
                            {{/each}}
                        </div>
                    {{/if}}
                </section>
            </div>

        </section>
    </div>

{% endtplhandlebars %}

